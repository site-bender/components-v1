---
import "./index.css"
import Microdata from "../Microdata/index.astro"
import TrailList from "./TrailList/index.astro"
import getBreadcrumbTrail from "../../utilities/getBreadcrumbTrail"
import generateShortId from "../../utilities/generateShortId"
import mapAttributes from "../../utilities/mapAttributes"
import type { TrailProps as Props } from "../../types"
import compact from "../../utilities/compact"

const {
	fallback,
	hideClass,
	id = generateShortId(),
	nav = {},
	pages,
	properties,
	...attrs
} = Astro.props

const { pathname } = Astro.url
const crumbs = compact(getBreadcrumbTrail(pathname, pages))

const wrapperAttrs = mapAttributes(attrs, ["sb-trail"])

const useMicrodata = Boolean(import.meta.env.USE_MICRODATA)
---

{
	useMicrodata ? (
		<Microdata {...wrapperAttrs} aria-labelledby={id} as="nav" {properties}>
			<TrailList {...nav} {crumbs} {fallback} {hideClass} {id} />
		</Microdata>
	) : (
		<nav {...wrapperAttrs} aria-labelledby={id}>
			<TrailList {...nav} {crumbs} {fallback} {hideClass} {id} />
		</nav>
	)
}
