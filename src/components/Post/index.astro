---
import "./index.css"
import Microdata from "../Microdata/index.astro"
import Byline from "../Byline/index.astro"
import Subtitle from "../Subtitle/index.astro"
import mapAttributes from "../../utilities/mapAttributes"
import type { PostProps as Props } from "../../types"

const {
  as = "span",
  asColumns,
  byline,
  header,
  heading = {},
  microdata,
  properties,
  subtitle,
  title,
  ...attrs
} = Astro.props

const { as: HElement = "h1", ...hAttrs } = heading

const headerAttrs = mapAttributes(header, ["sb-post-header"])
const headingAttrs = mapAttributes(hAttrs, ["sb-post-title"])
const wrapperAttrs = mapAttributes(
  attrs,
  asColumns ? ["sb-post", "sb-as-columns"] : ["sb-post"],
)

const useMicrodata = Boolean(import.meta.env.USE_MICRODATA)
const label = (await Astro.slots.render("title")) || title
const sublabel = (await Astro.slots.render("subtitle")) || subtitle
---

<article {...wrapperAttrs}>
  {
    useMicrodata ? (
      <Microdata
        {as}
        {microdata}
        {properties}
      />
    ) : null
  }
  <header {...headerAttrs}>
    <Byline {...byline} />
    <HElement
      {...headingAttrs}
      set:html={label}
    />
    <Subtitle>{sublabel}</Subtitle>
  </header>
  <slot />
</article>
