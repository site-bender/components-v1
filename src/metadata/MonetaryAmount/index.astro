---
import "./index.css";
import type { NumberStyle } from "../Number/types";
import Microdata from "../../Microdata/index.astro";
import Number from "../Number/index.astro";

const style: NumberStyle = "currency";

const {
  options: opts = {},
  properties = {},
  ...attrs
} = Astro.props;

const options = {
	currency: "USD",
	currencyDisplay: "narrowSymbol",
	style,
	...opts,
};

const meta = {
  type: "MonetaryAmount",
  ...properties,
	currency: opts.currency,
	value: (await Astro.slots.render("default")) || Astro.props.value,
};

const amount = parseFloat(String(Astro.props.value || meta.value).replaceAll(/[^.0-9]/g, ""))

const useMicrodata = Boolean(import.meta.env.USE_MICRODATA);
---

{
  useMicrodata ? (
    <Microdata as="span" properties={meta}>
      <Number
				{...attrs}
				data-sb-currency={options.currency}
				data-sb-amount={amount}
				{options}
				type="MonetaryAmount"
			>
				<slot />
			</Number>
    </Microdata>
  ) : (
      <Number
				{...attrs}
				data-sb-currency={options.currency}
				data-sb-amount={amount}
				{options}
				type="MonetaryAmount"
			>
				<slot />
			</Number>
  )
}
