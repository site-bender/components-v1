---
import Microdata from "../Microdata/index.astro"
import PictureElement from "./PictureElement/index.astro"
import mapAttributes from "../utilities/mapAttributes"
import type { PictureProps as Props } from "../types"
import "./index.css"


const {
  description = {},
  properties: props,
	wrapper = {},
  ...attrs
} = Astro.props

const descAttrs = mapAttributes(description, ["sb-picture-description"])
const wrapperAttrs = mapAttributes(wrapper, ["sb-picture-metadata"])

const desc = (await Astro.slots.render("default"))

const properties = {
	as: "span",
  type: "ImageObject",
	...props,
}

const useMicrodata = Boolean(import.meta.env.USE_MICRODATA)
---

{
	useMicrodata ? (
		<Microdata
			{...wrapperAttrs}
			data-sb-picture="metadata"
			{properties}
		>
			<PictureElement {...attrs} {descAttrs}>
				<Fragment set:html={desc} />
			</PictureElement>
		</Microdata>
	) : (
		<PictureElement {...attrs} {descAttrs}>
			<Fragment set:html={desc} />
		</PictureElement>
	)
}
