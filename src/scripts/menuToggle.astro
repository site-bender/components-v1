<script>
  function addToggle() {
    const toggle = document.querySelector("#sb-menu-toggle") as HTMLInputElement

    document.querySelector("main")?.addEventListener("click", function (event) {
      const target = event.target as HTMLElement

      if (
        !target.matches(".sb-menu *") &&
        !target.matches("#sb-menu-toggle") &&
        toggle &&
        toggle.checked
      ) {
        toggle.checked = false
        document.body.classList.remove("sb-menu-open")

        if (
          toggle.checked === false &&
          globalThis.location.hash === "#site-menu"
        ) {
          const page = `${globalThis.location.origin}${globalThis.location.pathname}`

          if (document.referrer === page) {
            globalThis.history.back()
          }
        }

        return undefined
      }

      if (toggle.checked) {
        document.body.classList.add("sb-menu-open")
        return undefined
      }

      document.body.classList.remove("sb-menu-open")
    })
  }

  globalThis.addEventListener("DOMContentLoaded", addToggle)
</script>
